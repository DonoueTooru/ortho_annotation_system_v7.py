# Requirement 4: åº§æ¨™ç³»ã®ãšã‚Œä¿®æ­£ - å®Ÿè£…å®Œäº†

## ğŸ“‹ æ¦‚è¦

**å•é¡Œ**: ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨­å®šãŒX=0, Y=0ã§ã‚‚ã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§è¨­å®šã—ãŸä½ç½®ã¨ä¿å­˜ç”»åƒã®ä½ç½®ãŒãšã‚Œã‚‹

**æ ¹æœ¬åŸå› **: `copy_related_images()`ãŒã‚ªãƒ«ã‚½ç”»åƒã®åº§æ¨™ç³»ã‚’ä½¿ç”¨ã—ã¦ã„ãŸ

**è§£æ±ºç­–**: `thermal_overlays`/`visible_overlays`ã«ä¿å­˜ã•ã‚ŒãŸåº§æ¨™ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´

---

## ğŸ” å•é¡Œã®è©³ç´°

### ãƒ¦ãƒ¼ã‚¶ãƒ¼å ±å‘Š

> "ç¾åœ¨ã€èª¿æ•´å¹…ã‚’Xã¨Yã¨ã‚‚ã«ï¼ã«ã—ã¦ã„ã‚‹ã®ã«ã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ç”»é¢ã§è¨­å®šã—ãŸä½ç½®ã¨ãšã‚ŒãŒç”Ÿã˜ã¦ã„ã‚‹"

### æ ¹æœ¬åŸå› ã®ç™ºè¦‹

#### å•é¡Œã®ã‚ã£ãŸå®Ÿè£…

**`copy_related_images()` (Line 5047-5081)**:

```python
def copy_related_images(self):
    for annotation in self.annotations:
        annotation_id = annotation['id']
        x = annotation['x']  # â† ã‚ªãƒ«ã‚½ç”»åƒï¼ˆå…¨ä½“å›³ï¼‰ã®åº§æ¨™ç³»ï¼
        y = annotation['y']  # â† ã‚ªãƒ«ã‚½ç”»åƒï¼ˆå…¨ä½“å›³ï¼‰ã®åº§æ¨™ç³»ï¼
        
        # ã‚µãƒ¼ãƒ¢ç”»åƒã®å‡¦ç†
        if annotation.get('thermal_image'):
            thermal_image = Image.open(src_path)
            
            # ã‚ªãƒ«ã‚½åº§æ¨™ç³»ã‚’ã‚µãƒ¼ãƒ¢ç”»åƒã«é©ç”¨ â†’ ãšã‚ŒãŒç™ºç”Ÿï¼
            annotated_thermal = self._draw_annotation_on_related_image(
                thermal_image,
                x, y,  # â† é–“é•ã£ãŸåº§æ¨™ç³»
                ...
                image_type='thermal'
            )
```

#### æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã«ã¯**3ã¤ã®åº§æ¨™ç³»**ãŒå­˜åœ¨ã—ã¾ã™ï¼š

1. **`annotation['x']`, `annotation['y']`**
   - ã‚ªãƒ«ã‚½ç”»åƒï¼ˆå…¨ä½“å›³ï¼‰ã®åº§æ¨™ç³»
   - ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã§ã‚¯ãƒªãƒƒã‚¯ã—ãŸä½ç½®

2. **`annotation['thermal_overlays']`**
   ```python
   [
       {"x": 123.4, "y": 567.8},  # ã‚µãƒ¼ãƒ¢ç”»åƒã®åº§æ¨™ç³»
       ...
   ]
   ```
   - ã‚µãƒ¼ãƒ¢ç”»åƒã®åº§æ¨™ç³»
   - ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ã‚µãƒ¼ãƒ¢ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã‚¯ãƒªãƒƒã‚¯ã—ãŸä½ç½®

3. **`annotation['visible_overlays']`**
   ```python
   [
       {"x": 234.5, "y": 678.9},  # å¯è¦–ç”»åƒã®åº§æ¨™ç³»
       ...
   ]
   ```
   - å¯è¦–ç”»åƒã®åº§æ¨™ç³»
   - ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å¯è¦–ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã‚¯ãƒªãƒƒã‚¯ã—ãŸä½ç½®

### åº§æ¨™ç³»ã®é•ã„

- **ã‚ªãƒ«ã‚½ç”»åƒ**: å…¨ä½“å›³ï¼ˆä¾‹: 10000Ã—8000pxï¼‰
- **ã‚µãƒ¼ãƒ¢ç”»åƒ**: å€‹åˆ¥ç”»åƒï¼ˆä¾‹: 640Ã—512pxï¼‰
- **å¯è¦–ç”»åƒ**: å€‹åˆ¥ç”»åƒï¼ˆä¾‹: 640Ã—512pxï¼‰

ã“ã‚Œã‚‰ã¯**ç•°ãªã‚‹ã‚¹ã‚±ãƒ¼ãƒ«ãƒ»ç•°ãªã‚‹ç”»åƒã‚µã‚¤ã‚º**ã‚’æŒã¤ãŸã‚ã€åº§æ¨™ç³»ãŒç•°ãªã‚Šã¾ã™ã€‚

---

## ğŸ’¡ å®Ÿè£…ã—ãŸè§£æ±ºç­–

### ä¿®æ­£å†…å®¹

**`copy_related_images()` ã®ä¿®æ­£**:

#### Beforeï¼ˆå•é¡Œã®ã‚ã£ãŸã‚³ãƒ¼ãƒ‰ï¼‰

```python
def copy_related_images(self):
    for annotation in self.annotations:
        annotation_id = annotation['id']
        x = annotation['x']  # â† ã‚ªãƒ«ã‚½åº§æ¨™ç³»
        y = annotation['y']  # â† ã‚ªãƒ«ã‚½åº§æ¨™ç³»
        
        # ã‚µãƒ¼ãƒ¢ç”»åƒã®å‡¦ç†
        if annotation.get('thermal_image'):
            src_path = annotation['thermal_image']
            if os.path.exists(src_path):
                thermal_image = Image.open(src_path)
                
                # âŒ ã‚ªãƒ«ã‚½åº§æ¨™ç³»ã‚’ã‚µãƒ¼ãƒ¢ç”»åƒã«é©ç”¨
                annotated_thermal = self._draw_annotation_on_related_image(
                    thermal_image, x, y, ...
                )
```

#### Afterï¼ˆä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰ï¼‰

```python
def copy_related_images(self):
    """
    ä¿®æ­£å†…å®¹ï¼ˆRequirement 4å¯¾å¿œï¼‰:
    - thermal_overlays/visible_overlaysã«ä¿å­˜ã•ã‚ŒãŸåº§æ¨™ã‚’ä½¿ç”¨
    - ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§è¨­å®šã—ãŸä½ç½®ã‚’åŸºæº–ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨
    """
    for annotation in self.annotations:
        annotation_id = annotation['id']
        
        # ã‚µãƒ¼ãƒ¢ç”»åƒã®å‡¦ç†
        if annotation.get('thermal_image'):
            src_path = annotation['thermal_image']
            # âœ… thermal_overlaysã‹ã‚‰åº§æ¨™ã‚’å–å¾—
            thermal_overlays = annotation.get('thermal_overlays', [])
            
            if os.path.exists(src_path) and thermal_overlays:
                thermal_image = Image.open(src_path)
                
                # âœ… thermal_overlaysã®å„åº§æ¨™ã«ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æç”»
                for overlay_point in thermal_overlays:
                    x = overlay_point['x']  # ã‚µãƒ¼ãƒ¢ç”»åƒã®åº§æ¨™ç³»
                    y = overlay_point['y']  # ã‚µãƒ¼ãƒ¢ç”»åƒã®åº§æ¨™ç³»
                    
                    thermal_image = self._draw_annotation_on_related_image(
                        thermal_image, x, y, ..., image_type='thermal'
                    )
                
                annotated_thermal = thermal_image
```

### ä¿®æ­£ã®ãƒã‚¤ãƒ³ãƒˆ

1. **æ­£ã—ã„åº§æ¨™ç³»ã®ä½¿ç”¨**:
   - ã‚µãƒ¼ãƒ¢ç”»åƒ â†’ `thermal_overlays`ã®åº§æ¨™ã‚’ä½¿ç”¨
   - å¯è¦–ç”»åƒ â†’ `visible_overlays`ã®åº§æ¨™ã‚’ä½¿ç”¨

2. **è¤‡æ•°ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ**:
   - `thermal_overlays`/`visible_overlays`ã¯é…åˆ—å½¢å¼
   - 1ã¤ã®ç”»åƒã«è¤‡æ•°ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æç”»å¯èƒ½

3. **ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨ã®åŸºæº–**:
   - `image_type='thermal'` â†’ `thermal_offset_x/y`ã‚’é©ç”¨
   - `image_type='visible'` â†’ `visible_offset_x/y`ã‚’é©ç”¨
   - ã‚ªãƒ•ã‚»ãƒƒãƒˆã¯`draw_annotation_icon_on_image()`å†…ã§é©ç”¨

---

## ğŸ¯ æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ

### ä¿®æ­£å‰ï¼ˆå•é¡Œã‚ã‚Šï¼‰

```
ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã‚µãƒ¼ãƒ¢ç”»åƒã®(100, 100)ã‚’ã‚¯ãƒªãƒƒã‚¯
â†“
thermal_overlays = [{"x": 100, "y": 100}]  â† æ­£ã—ãä¿å­˜
â†“
copy_related_images()å®Ÿè¡Œ
â†“
x = annotation['x'] = 5000  â† ã‚ªãƒ«ã‚½åº§æ¨™ç³»ã‚’ä½¿ç”¨ï¼
y = annotation['y'] = 4000  â† ã‚ªãƒ«ã‚½åº§æ¨™ç³»ã‚’ä½¿ç”¨ï¼
â†“
ã‚µãƒ¼ãƒ¢ç”»åƒ(640Ã—512)ã«(5000, 4000)ã‚’æç”» â† ç¯„å›²å¤–ã§ãšã‚Œã‚‹ï¼
```

### ä¿®æ­£å¾Œï¼ˆæ­£å¸¸ï¼‰

```
ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã‚µãƒ¼ãƒ¢ç”»åƒã®(100, 100)ã‚’ã‚¯ãƒªãƒƒã‚¯
â†“
thermal_overlays = [{"x": 100, "y": 100}]  â† æ­£ã—ãä¿å­˜
â†“
copy_related_images()å®Ÿè¡Œ
â†“
thermal_overlays[0]ã‹ã‚‰å–å¾—
x = 100  â† ã‚µãƒ¼ãƒ¢åº§æ¨™ç³»ã‚’ä½¿ç”¨ï¼
y = 100  â† ã‚µãƒ¼ãƒ¢åº§æ¨™ç³»ã‚’ä½¿ç”¨ï¼
â†“
ã‚µãƒ¼ãƒ¢ç”»åƒ(640Ã—512)ã«(100, 100)ã‚’æç”» â† æ­£ã—ã„ä½ç½®ï¼
â†“
ã‚ªãƒ•ã‚»ãƒƒãƒˆ0: (100, 100)ã«æç”»
ã‚ªãƒ•ã‚»ãƒƒãƒˆ+10: (110, 110)ã«æç”»  â† ç·¨é›†ä½ç½®ã‚’åŸºæº–ã«èª¿æ•´
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆé …ç›®

### ãƒ†ã‚¹ãƒˆ1: ã‚ªãƒ•ã‚»ãƒƒãƒˆ0ã§ã®ä½ç½®ç¢ºèª

**æ‰‹é †**:
1. ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã‚µãƒ¼ãƒ¢ç”»åƒã®ç‰¹å®šä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯
2. å¯è¦–ç”»åƒã®ç‰¹å®šä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨­å®šã‚’X=0, Y=0ã®ã¾ã¾ä¿å­˜
4. ä¿å­˜ã•ã‚ŒãŸã‚µãƒ¼ãƒ¢ç”»åƒãƒ»å¯è¦–ç”»åƒã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã‚¯ãƒªãƒƒã‚¯ã—ãŸä½ç½®ã¨ä¸€è‡´

### ãƒ†ã‚¹ãƒˆ2: ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨å¾Œã®ä½ç½®ç¢ºèª

**æ‰‹é †**:
1. ãƒ†ã‚¹ãƒˆ1ã®çŠ¶æ…‹ã‹ã‚‰ã€ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨­å®šã‚’X=+20, Y=+20ã«å¤‰æ›´
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿å­˜
3. ä¿å­˜ã•ã‚ŒãŸã‚µãƒ¼ãƒ¢ç”»åƒãƒ»å¯è¦–ç”»åƒã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ä½ç½®ã‹ã‚‰+20pxç§»å‹•ã—ã¦ã„ã‚‹

### ãƒ†ã‚¹ãƒˆ3: è¤‡æ•°ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª

**æ‰‹é †**:
1. ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§è¤‡æ•°ã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆä¾‹: 3ç®‡æ‰€ï¼‰
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿å­˜
3. ä¿å­˜ã•ã‚ŒãŸç”»åƒã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
- ã™ã¹ã¦ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£ã—ã„ä½ç½®ã«æç”»ã•ã‚Œã¦ã„ã‚‹

---

## ğŸ“ æŠ€è¡“çš„ãªè©³ç´°

### ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®åº§æ¨™å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯

**ImageAnnotationPreview ã‚¯ãƒ©ã‚¹** (Line 3778-4065):

#### ç”»åƒè¡¨ç¤ºæ™‚ã®åº§æ¨™å¤‰æ›

```python
# Line 3843-3857
def _render_image(self):
    with Image.open(self.image_path) as img:
        width, height = img.size
        # è¡¨ç¤ºã‚¹ã‚±ãƒ¼ãƒ«ã‚’è¨ˆç®—
        scale = min(self.canvas_width / width, self.canvas_height / height, 1.0)
        display_size = (int(width * scale), int(height * scale))
        
        self.display_scale = width and (display_size[0] / width) or 1.0
        self.offset_x = (self.canvas_width - self.display_width) / 2
        self.offset_y = (self.canvas_height - self.display_height) / 2
```

#### ã‚¯ãƒªãƒƒã‚¯åº§æ¨™ã‚’å…ƒç”»åƒåº§æ¨™ã«å¤‰æ›

```python
# Line 3928-3940
def on_left_click(self, event):
    canvas_x = self.canvas.canvasx(event.x)
    canvas_y = self.canvas.canvasy(event.y)
    
    # ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’é™¤å»
    norm_x = canvas_x - self.offset_x
    norm_y = canvas_y - self.offset_y
    
    # è¡¨ç¤ºã‚¹ã‚±ãƒ¼ãƒ«ã§é™¤ç®—ã—ã¦å…ƒç”»åƒåº§æ¨™ã‚’å–å¾—
    original_x = norm_x / self.display_scale
    original_y = norm_y / self.display_scale
    
    # å…ƒç”»åƒåº§æ¨™ç³»ã§ä¿å­˜
    self.working_points.append({"x": original_x, "y": original_y})
```

#### ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¿å­˜

```python
# Line 4043
def confirm(self):
    # thermal_overlays ã¾ãŸã¯ visible_overlays ã«ä¿å­˜
    self.annotation[self.annotation_key] = copy.deepcopy(self.working_points)
```

### ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨ãƒ­ã‚¸ãƒƒã‚¯

**draw_annotation_icon_on_image()** (Line 2830-2870):

```python
def draw_annotation_icon_on_image(self, image, draw, x, y, ..., image_type=None):
    # ã‚ªãƒ•ã‚»ãƒƒãƒˆã®é©ç”¨
    offset_x = 0
    offset_y = 0
    if image_type == 'thermal':
        offset_x = self.thermal_offset_x
        offset_y = self.thermal_offset_y
    elif image_type == 'visible':
        offset_x = self.visible_offset_x
        offset_y = self.visible_offset_y
    elif image_type == 'ortho':
        offset_x = self.ortho_offset_x
        offset_y = self.ortho_offset_y
    
    # ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨å¾Œã®åº§æ¨™
    adjusted_x = x + offset_x
    adjusted_y = y + offset_y
    
    # adjusted_x, adjusted_y ã‚’ä½¿ã£ã¦æç”»...
```

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### å…¨ä½“ã®æµã‚Œ

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ]
    â†“
[ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã‚µãƒ¼ãƒ¢ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯]
    â†“
[å…ƒç”»åƒåº§æ¨™ç³»ã«å¤‰æ›] (display_scale ã§é™¤ç®—)
    â†“
[thermal_overlays ã«ä¿å­˜] (annotations.json)
    â†“
[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜]
    â†“
[copy_related_images() å®Ÿè¡Œ]
    â†“
[thermal_overlays ã‹ã‚‰åº§æ¨™ã‚’å–å¾—]
    â†“
[ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨] (thermal_offset_x/y ã‚’åŠ ç®—)
    â†“
[ã‚µãƒ¼ãƒ¢ç”»åƒã«æç”»]
    â†“
[ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜] (ã‚µãƒ¼ãƒ¢ç”»åƒãƒ•ã‚©ãƒ«ãƒ€/ID001_ä¸å…·åˆ_ã‚µãƒ¼ãƒ¢ç•°å¸¸.jpg)
```

---

## âœ… å®Ÿè£…å®Œäº†é …ç›®

### ä¿®æ­£ã—ãŸã‚³ãƒ¼ãƒ‰

1. **`copy_related_images()` ãƒ¡ã‚½ãƒƒãƒ‰** (Line 5047-5140)
   - ã‚µãƒ¼ãƒ¢ç”»åƒå‡¦ç†: `thermal_overlays`ä½¿ç”¨ã«å¤‰æ›´
   - å¯è¦–ç”»åƒå‡¦ç†: `visible_overlays`ä½¿ç”¨ã«å¤‰æ›´
   - è¤‡æ•°ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ

### æ—¢å­˜ã®æ­£å¸¸ãªå®Ÿè£…ï¼ˆå¤‰æ›´ãªã—ï¼‰

1. **ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®åº§æ¨™å¤‰æ›** (Line 3778-4065)
   - æ­£ã—ãå…ƒç”»åƒåº§æ¨™ç³»ã«å¤‰æ›
   - `thermal_overlays`/`visible_overlays`ã«æ­£ã—ãä¿å­˜

2. **ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨ãƒ­ã‚¸ãƒƒã‚¯** (Line 2830-2870, 2714-2775)
   - `image_type`ã«å¿œã˜ã¦æ­£ã—ãã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨

3. **ã‚ªãƒ«ã‚½ç”»åƒã®ä¿å­˜** (Line 4668-4754)
   - `annotation['x']`/`annotation['y']`ï¼ˆã‚ªãƒ«ã‚½åº§æ¨™ç³»ï¼‰ã‚’ä½¿ç”¨
   - æ­£ã—ã„å‹•ä½œã‚’ç¶­æŒ

---

## ğŸ¯ åŠ¹æœ

### Beforeï¼ˆä¿®æ­£å‰ï¼‰

- âŒ ã‚ªãƒ•ã‚»ãƒƒãƒˆ0ã§ã‚‚ç·¨é›†ä½ç½®ã¨ãšã‚Œã‚‹
- âŒ ã‚ªãƒ•ã‚»ãƒƒãƒˆèª¿æ•´ã—ã¦ã‚‚æ„å›³ã—ãŸä½ç½®ã«å‹•ã‹ãªã„
- âŒ ã‚µãƒ¼ãƒ¢/å¯è¦–ç”»åƒã®åº§æ¨™ç³»ãŒç„¡è¦–ã•ã‚Œã¦ã„ãŸ

### Afterï¼ˆä¿®æ­£å¾Œï¼‰

- âœ… ã‚ªãƒ•ã‚»ãƒƒãƒˆ0ã§ç·¨é›†ä½ç½®ã¨å®Œå…¨ä¸€è‡´
- âœ… ã‚ªãƒ•ã‚»ãƒƒãƒˆèª¿æ•´ã§ç·¨é›†ä½ç½®ã‚’åŸºæº–ã«ç§»å‹•
- âœ… å„ç”»åƒã®åº§æ¨™ç³»ã‚’æ­£ã—ãä½¿ç”¨

---

## ğŸ“š é–¢é€£æƒ…å ±

### é–¢é€£å®Ÿè£…

- **Requirement 2**: ã‚µãƒ¼ãƒ¢/å¯è¦–ç”»åƒã‚ªãƒ•ã‚»ãƒƒãƒˆè¨­å®šï¼ˆæ­£å¸¸å‹•ä½œï¼‰
- **Requirement 3**: ã‚ªãƒ«ã‚½ç”»åƒã‚ªãƒ•ã‚»ãƒƒãƒˆè¨­å®šï¼ˆæ­£å¸¸å‹•ä½œï¼‰
- **Requirement 4**: åº§æ¨™ç³»ã®ãšã‚Œä¿®æ­£ï¼ˆä»Šå›ã®å®Ÿè£…ï¼‰

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```json
{
  "id": 1,
  "x": 5000,
  "y": 4000,
  "thermal_image": "/path/to/thermal.jpg",
  "thermal_overlays": [
    {"x": 100, "y": 100}
  ],
  "visible_image": "/path/to/visible.jpg",
  "visible_overlays": [
    {"x": 120, "y": 110}
  ]
}
```

---

## ğŸ¤” ä»Šå¾Œã®æ‹¡å¼µæ€§

### ç¾åœ¨ã®è¨­è¨ˆã®åˆ©ç‚¹

1. **è¤‡æ•°ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ**:
   - 1ã¤ã®ç”»åƒã«è¤‡æ•°ãƒãƒ¼ã‚«ãƒ¼ã‚’é…ç½®å¯èƒ½
   - `thermal_overlays`/`visible_overlays`ãŒé…åˆ—å½¢å¼

2. **ç‹¬ç«‹ã—ãŸåº§æ¨™ç³»**:
   - ã‚ªãƒ«ã‚½ç”»åƒã€ã‚µãƒ¼ãƒ¢ç”»åƒã€å¯è¦–ç”»åƒãŒç‹¬ç«‹
   - ç”»åƒã‚µã‚¤ã‚ºãŒç•°ãªã£ã¦ã‚‚æ­£å¸¸å‹•ä½œ

3. **ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨ã®æŸ”è»Ÿæ€§**:
   - å„ç”»åƒã‚¿ã‚¤ãƒ—ã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚ªãƒ•ã‚»ãƒƒãƒˆè¨­å®š
   - ç·¨é›†ä½ç½®ã‚’åŸºæº–ã«èª¿æ•´å¯èƒ½

### å°†æ¥ã®æ‹¡å¼µæ¡ˆ

1. **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½**:
   - ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨­å®šå¤‰æ›´æ™‚ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
   - ä¿å­˜å‰ã«çµæœã‚’ç¢ºèª

2. **ãƒãƒƒãƒã‚ªãƒ•ã‚»ãƒƒãƒˆèª¿æ•´**:
   - å…¨ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ä¸€æ‹¬èª¿æ•´
   - è¤‡æ•°ç”»åƒã®ä½ç½®ã‚’åŒæ™‚ã«è£œæ­£

3. **åº§æ¨™ç³»å¤‰æ›æ©Ÿèƒ½**:
   - ã‚ªãƒ«ã‚½åº§æ¨™ã‹ã‚‰ã‚µãƒ¼ãƒ¢/å¯è¦–åº§æ¨™ã¸ã®è‡ªå‹•å¤‰æ›
   - GPSåº§æ¨™ã¨ã®é€£æº

---

## ğŸ“‹ ã¾ã¨ã‚

### å•é¡Œ

ã‚ªãƒ•ã‚»ãƒƒãƒˆ0ã§ã‚‚ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ä½ç½®ã¨ãšã‚ŒãŒç™ºç”Ÿ

### åŸå› 

`copy_related_images()`ãŒã‚ªãƒ«ã‚½åº§æ¨™ç³»ã‚’ä½¿ç”¨ã—ã¦ã„ãŸ

### è§£æ±ºç­–

`thermal_overlays`/`visible_overlays`ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´

### åŠ¹æœ

- ã‚ªãƒ•ã‚»ãƒƒãƒˆ0ã§å®Œå…¨ä¸€è‡´
- ã‚ªãƒ•ã‚»ãƒƒãƒˆèª¿æ•´ãŒç·¨é›†ä½ç½®ã‚’åŸºæº–ã«å‹•ä½œ
- å„ç”»åƒã®åº§æ¨™ç³»ã‚’æ­£ã—ãå°Šé‡

---

**å®Ÿè£…å®Œäº†æ—¥**: 2025-11-07
**å®Ÿè£…è€…**: GenSpark AI Developer
**é–¢é€£PR**: #1
